<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Operations Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Student Operations Test</h1>
        
        <!-- Toast Container -->
        <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
        
        <!-- Test Buttons -->
        <div class="row mb-4">
            <div class="col-12">
                <button id="test-load-students" class="btn btn-primary me-2">Test Load Students</button>
                <button id="test-create-student" class="btn btn-success me-2">Test Create Student</button>
                <button id="test-update-student" class="btn btn-warning me-2">Test Update Student</button>
                <button id="test-delete-student" class="btn btn-danger me-2">Test Delete Student</button>
            </div>
        </div>
        
        <!-- Results -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Results</h5>
                    </div>
                    <div class="card-body">
                        <pre id="test-results" class="bg-light p-3" style="height: 400px; overflow-y: auto;"></pre>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Students Component Container -->
        <div class="row mt-4">
            <div class="col-12">
                <div id="students-container"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
        import { StudentService } from './js/services/studentService.js';
        import { NotificationService } from './js/services/notification.js';
        import Students from './js/components/students.js';

        // Initialize services
        const studentService = new StudentService();
        const notificationService = new NotificationService();
        const resultsElement = document.getElementById('test-results');

        // Mock APP_CONFIG for testing
        window.APP_CONFIG = {
            API_BASE_URL: 'http://localhost:8080',
            TOKEN_KEY: 'sim_token'
        };

        // Mock localStorage token
        localStorage.setItem('sim_token', 'mock-jwt-token');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            resultsElement.textContent += `[${timestamp}] ${message}\n`;
            resultsElement.scrollTop = resultsElement.scrollHeight;
            console.log(message);
        }

        // Test Load Students
        document.getElementById('test-load-students').addEventListener('click', async () => {
            try {
                log('Testing load students...');
                const params = {
                    page: 0,
                    size: 10,
                    sortBy: 'lastName',
                    sortDir: 'asc',
                    filters: {
                        status: 'ACTIVE'
                    }
                };
                
                const result = await studentService.getStudents(params);
                log(`✓ Load students successful: ${JSON.stringify(result, null, 2)}`);
                notificationService.showSuccess('Students loaded successfully');
            } catch (error) {
                log(`✗ Load students failed: ${error.message}`);
                notificationService.showError(`Load students failed: ${error.message}`);
            }
        });

        // Test Create Student
        document.getElementById('test-create-student').addEventListener('click', async () => {
            try {
                log('Testing create student...');
                const studentData = {
                    firstName: 'Test',
                    lastName: 'Student',
                    email: 'test.student@example.com',
                    studentId: 'STU9999',
                    classRoom: '10A',
                    major: 'SCIENCE',
                    status: 'ACTIVE',
                    phone: '+1234567890',
                    address: '123 Test Street',
                    enrollmentDate: new Date().toISOString()
                };
                
                const result = await studentService.createStudent(studentData);
                log(`✓ Create student successful: ${JSON.stringify(result, null, 2)}`);
                notificationService.showSuccess('Student created successfully');
            } catch (error) {
                log(`✗ Create student failed: ${error.message}`);
                notificationService.showError(`Create student failed: ${error.message}`);
            }
        });

        // Test Update Student
        document.getElementById('test-update-student').addEventListener('click', async () => {
            try {
                log('Testing update student...');
                const studentData = {
                    id: 1,
                    firstName: 'Updated',
                    lastName: 'Student',
                    email: 'updated.student@example.com',
                    studentId: 'STU0001',
                    classRoom: '11A',
                    major: 'MATHEMATICS',
                    status: 'ACTIVE',
                    phone: '+1234567890',
                    address: '456 Updated Street',
                    enrollmentDate: new Date().toISOString()
                };
                
                const result = await studentService.updateStudent(1, studentData);
                log(`✓ Update student successful: ${JSON.stringify(result, null, 2)}`);
                notificationService.showSuccess('Student updated successfully');
            } catch (error) {
                log(`✗ Update student failed: ${error.message}`);
                notificationService.showError(`Update student failed: ${error.message}`);
            }
        });

        // Test Delete Student
        document.getElementById('test-delete-student').addEventListener('click', async () => {
            try {
                log('Testing delete student...');
                const result = await studentService.deleteStudent(1);
                log(`✓ Delete student successful: ${result}`);
                notificationService.showSuccess('Student deleted successfully');
            } catch (error) {
                log(`✗ Delete student failed: ${error.message}`);
                notificationService.showError(`Delete student failed: ${error.message}`);
            }
        });

        // Test validation
        log('Testing student data validation...');
        try {
            studentService.validateStudentData({
                firstName: 'John',
                lastName: 'Doe',
                email: 'john@example.com',
                studentId: 'STU0001',
                classRoom: '10A',
                major: 'SCIENCE',
                status: 'ACTIVE'
            });
            log('✓ Valid student data validation passed');
        } catch (error) {
            log(`✗ Valid student data validation failed: ${error.message}`);
        }

        try {
            studentService.validateStudentData({
                firstName: 'John'
                // Missing required fields
            });
            log('✗ Invalid student data validation should have failed');
        } catch (error) {
            log(`✓ Invalid student data validation correctly failed: ${error.message}`);
        }

        // Initialize Students component
        log('Initializing Students component...');
        try {
            const studentsComponent = new Students();
            const container = document.getElementById('students-container');
            container.innerHTML = await studentsComponent.render();
            await studentsComponent.init();
            log('✓ Students component initialized successfully');
        } catch (error) {
            log(`✗ Students component initialization failed: ${error.message}`);
        }

        log('Student operations test page loaded successfully');
    </script>
</body>
</html>